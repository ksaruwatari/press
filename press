import { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Checkbox } from "@/components/ui/checkbox";

// â‘ å®šå‹è©•ä¾¡ â‘¡ç·åˆè©•ä¾¡ â‘¢æ—¥æ™‚åˆ†é¡ â‘£è¦æ¨¡åˆ†é¡ â‘¤è©³ç´°ãƒšãƒ¼ã‚¸ï¼‹1å›æŠ•ç¥¨

const CRITERIA = [
  "äº‹å®Ÿç¢ºèªãŒæ˜ç¢ºã§ã‚ã‚‹",
  "è«–ç‚¹ãŒæ•´ç†ã•ã‚Œã¦ã„ã‚‹",
  "å¸‚æ°‘ã«ã¨ã£ã¦çŸ¥ã‚‹ä¾¡å€¤ãŒé«˜ã„",
  "å›ç­”ã‚’å¼•ãå‡ºã™æ§‹æˆã«ãªã£ã¦ã„ã‚‹",
  "é‡è¤‡è³ªå•ã§ã‚ã‚‹",
  "å‰æãŒä¸æ˜ç¢ºã§ã‚ã‚‹",
];

export default function PressConferenceReviewApp() {
  const [page, setPage] = useState("home"); // home | list | detail
  const [selectedConf, setSelectedConf] = useState(null);

  const [filters, setFilters] = useState({ level: "all", date: "" });

  const [conferences, setConferences] = useState([
    {
      id: 1,
      name: "å†…é–£å®˜æˆ¿é•·å®˜ å®šä¾‹è¨˜è€…ä¼šè¦‹",
      date: "2025-01-10",
      level: "å›½",
      questions: [
        {
          id: 1,
          text: "ä»Šå›ã®æ”¿ç­–å¤‰æ›´ã®æ³•çš„æ ¹æ‹ ã‚’å…·ä½“çš„ã«æ•™ãˆã¦ãã ã•ã„ã€‚",
          votesUp: 12,
          votesDown: 3,
          criteria: {},
          voted: false,
        },
        {
          id: 2,
          text: "å›½æ°‘ã®ç†è§£ã¯å¾—ã‚‰ã‚Œã¦ã„ã‚‹ã¨ãŠè€ƒãˆã§ã™ã‹ã€‚",
          votesUp: 4,
          votesDown: 10,
          criteria: {},
          voted: false,
        },
      ],
    },
    {
      id: 2,
      name: "â—¯â—¯çœŒçŸ¥äº‹ å®šä¾‹è¨˜è€…ä¼šè¦‹",
      date: "2025-01-08",
      level: "éƒ½é“åºœçœŒ",
      questions: [
        {
          id: 1,
          text: "äºˆç®—å¢—é¡ã®è²¡æºã¯ã©ã“ã‹ã‚‰ç¢ºä¿ã—ã¾ã™ã‹ã€‚",
          votesUp: 9,
          votesDown: 1,
          criteria: {},
          voted: false,
        },
      ],
    },
  ]);

  const voteOnce = (confId, qId, type) => {
    setConferences((prev) =>
      prev.map((c) =>
        c.id === confId
          ? {
              ...c,
              questions: c.questions.map((q) =>
                q.id === qId && !q.voted
                  ? {
                      ...q,
                      voted: true,
                      votesUp: type === "up" ? q.votesUp + 1 : q.votesUp,
                      votesDown:
                        type === "down" ? q.votesDown + 1 : q.votesDown,
                    }
                  : q
              ),
            }
          : c
      )
    );
  };

  const toggleCriteria = (confId, qId, label) => {
    setConferences((prev) =>
      prev.map((c) =>
        c.id === confId
          ? {
              ...c,
              questions: c.questions.map((q) =>
                q.id === qId
                  ? {
                      ...q,
                      criteria: { ...q.criteria, [label]: !q.criteria[label] },
                    }
                  : q
              ),
            }
          : c
      )
    );
  };

  const filtered = conferences.filter((c) => {
    if (filters.level !== "all" && c.level !== filters.level) return false;
    if (filters.date && c.date !== filters.date) return false;
    return true;
  });

  // ===== HOME =====
  if (page === "home") {
    return (
      <div className="p-6 max-w-5xl mx-auto text-center">
        <h1 className="text-4xl font-bold mb-4">è¨˜è€…ä¼šè¦‹ è³ªå•è©•ä¾¡ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</h1>
        <p className="text-gray-600 mb-8">
          è¨˜è€…ä¼šè¦‹ã«ãŠã‘ã‚‹ã€Œè³ªå•ã€ã‚’å¸‚æ°‘ã®è¦–ç‚¹ã§è©•ä¾¡ãƒ»å¯è¦–åŒ–ã™ã‚‹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 
        </p>
        <Button size="lg" onClick={() => setPage("list")}>
          ä¼šè¦‹ä¸€è¦§ã‚’è¦‹ã‚‹
        </Button>
      </div>
    );
  }

  // ===== DETAIL =====
  if (page === "detail" && selectedConf) {
    const conf = conferences.find((c) => c.id === selectedConf);
    return (
      <div className="p-6 max-w-5xl mx-auto">
        <Button variant="outline" className="mb-4" onClick={() => setPage("list")}>
          â† ä¼šè¦‹ä¸€è¦§ã¸æˆ»ã‚‹
        </Button>
        <h1 className="text-2xl font-bold mb-1">{conf.name}</h1>
        <p className="text-sm text-gray-600 mb-6">
          {conf.date} ï¼ è¦æ¨¡ï¼š{conf.level}
        </p>

        <div className="space-y-4">
          {conf.questions.map((q) => (
            <Card key={q.id} className="rounded-xl bg-gray-50">
              <CardContent className="p-4">
                <p className="mb-3">{q.text}</p>

                {/* â‘¡ç·åˆè©•ä¾¡ */}
                <div className="flex gap-3 mb-4">
                  <Button size="sm" disabled={q.voted} onClick={() => voteOnce(conf.id, q.id, "up")}>
                    ğŸ‘ æœ‰ç”¨ {q.votesUp}
                  </Button>
                  <Button size="sm" variant="outline" disabled={q.voted} onClick={() => voteOnce(conf.id, q.id, "down")}>
                    ğŸ‘ æ”¹å–„ {q.votesDown}
                  </Button>
                </div>

                {/* â‘ å®šå‹è©•ä¾¡ */}
                <div className="grid grid-cols-2 gap-2 text-sm">
                  {CRITERIA.map((label) => (
                    <label key={label} className="flex items-center gap-2">
                      <Checkbox checked={!!q.criteria[label]} onCheckedChange={() => toggleCriteria(conf.id, q.id, label)} />
                      {label}
                    </label>
                  ))}
                </div>
              </CardContent>
            </Card>
          ))}
        </div>
      </div>
    );
  }

  // ===== LIST =====
  return (
    <div className="p-6 max-w-6xl mx-auto">
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-3xl font-bold">ä¼šè¦‹ä¸€è¦§</h1>
        <Button variant="outline" onClick={() => setPage("home")}>
          ãƒˆãƒƒãƒ—ã¸
        </Button>
      </div>

      {/* â‘¢æ—¥æ™‚ï¼‹â‘£è¦æ¨¡ãƒ•ã‚£ãƒ«ã‚¿ */}
      <div className="flex gap-4 mb-8">
        <select className="border p-2 rounded" value={filters.level} onChange={(e) => setFilters({ ...filters, level: e.target.value })}>
          <option value="all">ã™ã¹ã¦ã®è¦æ¨¡</option>
          <option value="å›½">å›½</option>
          <option value="éƒ½é“åºœçœŒ">éƒ½é“åºœçœŒ</option>
          <option value="å¸‚åŒºç”ºæ‘">å¸‚åŒºç”ºæ‘</option>
        </select>
        <input type="date" className="border p-2 rounded" value={filters.date} onChange={(e) => setFilters({ ...filters, date: e.target.value })} />
      </div>

      <div className="grid md:grid-cols-2 gap-6">
        {filtered.map((conf) => (
          <Card key={conf.id} className="rounded-2xl shadow cursor-pointer hover:shadow-lg" onClick={() => { setSelectedConf(conf.id); setPage("detail"); }}>
            <CardContent className="p-6">
              <h2 className="text-xl font-semibold mb-1">{conf.name}</h2>
              <p className="text-sm text-gray-600">{conf.date} ï¼ è¦æ¨¡ï¼š{conf.level}</p>
              <p className="text-sm mt-2 text-gray-500">è³ªå•æ•°ï¼š{conf.questions.length}</p>
            </CardContent>
          </Card>
        ))}
      </div>
    </div>
  );
}
